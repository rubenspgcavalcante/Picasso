/**
* Picasso
* A Framework to build dinamic forms using MVC
* Build date: 2014-07-25
* @author Rubens Pinheiro Gonçalves Cavalcante
* @version 0.2.0
* @license GPLv3
*/
var Picasso=Picasso||{},P=P||Picasso;Picasso.info={author:"Rubens Pinheiro Gonçalves Cavalcante",version:"0.2.0",build:"2014-07-25",license:"GPLv3"},Picasso.load=function(a){var b=a.split("."),c=Picasso;"Picasso"===b[0]&&(b=b.slice(1));for(var d=0;d<b.length;d++)"undefined"==typeof c[b[d]]&&(c[b[d]]={}),c=c[b[d]];return c},Picasso.load("extend"),Picasso.extend.field=function(a,b){var c=Picasso.load("utils.object"),d=Picasso.load("utils.log");if("function"!=typeof b)throw new Picasso.error.InvalidParameters("Picasso.extend.field",{Field:"Invalid constructor"},this);c.isEmpty(b.prototype)||d.warn("Overriding the field prototype from given constructor",b),b.prototype=new Picasso.form.field.PicassoField,Picasso.form.FieldFactory.constructors.hasOwnProperty(a)&&d.warn("Overriding a already registered Picasso field "+a),Picasso.form.FieldFactory.constructors[a]=b},Picasso.extend.validator=function(a,b){var c=(Picasso.load("utils.object"),Picasso.load("utils.log"));if("function"!=typeof b)throw new Picasso.error.InvalidParameters("Picasso.extend.validator",{validator:"Invalid function"},this);Picasso.form.validators.hasOwnProperty(a)&&c.warn("Overriding a already registered Picasso field validator "+a),Picasso.form.validators[a]=b},Picasso.load("pjo.Event"),Picasso.pjo.Event=function(a,b,c){this.name=a||"any",this.data=b||null,this.target=c||null},Picasso.load("pjo.EventHandler"),Picasso.pjo.EventHandler=function(a,b,c){this.eventName=a||"",this.callback=b||new Function,this.context=c||null},Picasso.load("pjo.Field"),Picasso.pjo.Field=function(){this.id=null,this.label="",this.type=null,this.required=!1,this.formIgnore=!1,this.value=null,this.attrs={name:""}},Picasso.pjo.Field.type={TEXT:"text",TEXTAREA:"textarea",NUMBER:"number",EMAIL:"email",PASSWORD:"password",SUBMIT:"submit",CANCEL:"cancel"},Picasso.load("pjo.FieldGrid"),Picasso.pjo.FieldGrid=function(){this.id=null,this.index=0,this.colXSize=3,this.fields=[]},Picasso.pjo.FieldGrid.colSize={SMALL:2,MEDIUM:3,LARGE:4},Picasso.load("pjo.Form"),Picasso.pjo.Form=function(){this.id=null,this.attrs={action:"",method:"",name:""},this.gridBlocks=[]},Picasso.load("pjo.GridBlock"),Picasso.pjo.GridBlock=function(){this.id=null,this.legend=null,this.attrs={},this.fieldGrid=[]},Picasso.load("pjo.Validation"),Picasso.pjo.Validation=function(){this.field=null,this.errorMessages=[],this.valid=!1},Picasso.load("error.InvalidFieldType"),Picasso.error.InvalidFieldType=function(a){this.name="InvalidFieldType",this.message="Can't find a constructor. Invalid field type "+String(a)},Picasso.error.InvalidFieldType.prototype=Error.prototype,Picasso.error.InvalidFieldType.constructor=Picasso.error.InvalidFieldType,Picasso.load("error.InvalidParameters"),Picasso.error.InvalidParameters=function(a,b,c){this.name="InvalidParameters",this.message="The function "+a+" has received invalid parameters\n";var d="	parameter %param%: %dependence%;\n";for(var e in b)b.hasOwnProperty(e)&&(this.message+=d.replace("%param%",e).replace("%dependence%",b[e]));this.errorParameters=b||null,this.context=c||null},Picasso.error.InvalidParameters.prototype=Error.prototype,Picasso.error.InvalidParameters.constructor=Picasso.error.InvalidParameters,Picasso.load("error.NotImplementedError"),Picasso.error.NotImplementedError=function(a,b){this.name="NotImplementedError",this.message=a+" object child must implement the "+b+" method"},Picasso.error.NotImplementedError.prototype=Error.prototype,Picasso.error.NotImplementedError.constructor=Picasso.error.NotImplementedError,Picasso.load("utils.array"),Picasso.utils.array=function(){var a=Picasso.load("Picasso.utils.object"),b=function(b,c){for(var d=0;d<b.length;d++)if("object"==typeof b[d]&&"object"==typeof c){if(a.equals(b[d],c))return!0}else if(b[d]===c)return!0;return!1},c=function(a,c){if(a.length!=c.length)return!1;for(var d=0;d<c.length;d++)if(!b(a,c[d]))return!1;return!0},d=function(a,b){if("undefined"!=typeof a){var c,d;for(d=a.length,c=0;d>c;c++)b(a[c],c)}};return{find:b,equals:c,each:d}}(),Picasso.load("utils.html"),Picasso.utils.html=function(){var a=function(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setAttribute(c,b[c])},b=function(a,b){var c,d,e=a.classList;for(c=-1!=b.indexOf(" ")?b.split(" "):[b],d=0;d<c.length;d++)e.contains(c[d])||e.add(c[d])},c=function(a,b){var c,d,e=a.classList;for(c=-1!=b.indexOf(" ")?b.split(" "):[b],d=0;d<c.length;d++)e.contains(c[d])||e.remove(c[d])};return{setAttributes:a,addClass:b,removeClass:c}}(),Picasso.load("utils.log"),Picasso.utils.log=function(){var a=function(a,b){console.warn(a,b)};return{warn:a}}(),Picasso.load("utils.object"),Picasso.utils.object=function(){var a=function(a){return a.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})},b=function(a,b){var c=new Function;return c.prototype=b.prototype,a.prototype=new c,a._super=b.prototype,a.prototype.constructor=a,a},c=function(a,b){if(a instanceof Object){var c;for(c in a)a.hasOwnProperty(c)&&b(a[c],c)}},d=function(a,b){var c;for(c in a)if("undefined"==typeof b[c])return!1;for(c in a)if(a[c])switch(typeof a[c]){case"object":if(!a[c].equals(b[c]))return!1;break;case"function":if("undefined"==typeof b[c]||"equals"!=c&&a[c].toString()!=b[c].toString())return!1;break;default:if(a[c]!=b[c])return!1}else if(b[c])return!1;for(c in b)if("undefined"==typeof a[c])return!1;return!0},e=function(b,c){var d=new c,e={};for(var f in b)b.hasOwnProperty(f)&&(-1!=f.indexOf("-")?e[a(f)]=b[f]:e[f]=b[f]);for(var g in d)d.hasOwnProperty(g)&&e.hasOwnProperty(g)&&(d[g]=e[g]);return d},f=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};return{extend:b,equals:d,each:c,deserialize:e,isEmpty:f}}(),Picasso.load("core.Sequence"),Picasso.core.Sequence=function(){var a={},b=function(b){return"undefined"==typeof b||"string"!=typeof b?!1:(a.hasOwnProperty(b)||(a[b]=null),!0)},c=function(a){this._entity=a};return c.prototype.currentVal=function(){return b(this._entity)?a[this._entity]:null},c.prototype.nextVal=function(){return b(this._entity)?null==a[this._entity]?(a[this._entity]=0,0):++a[this._entity]:null},c}(),Picasso.load("core.Subject"),Picasso.core.Subject=function(){var a={},b=function(b,c,d){for(var e=a[c.name]||[],f=0;f<e.length;f++)if("fire"==b){var g=e[f].callback;"string"==typeof g&&e[f].context.hasOwnProperty(g)?e[f].context[g](c):e[f].callback.call(e.context,c)}else e[f].callback!==d||null!=c.context&&e.context!==c.context||e.splice(f,1)};this._subscribe=function(b,c,d){if("undefined"==typeof b)throw new Picasso.error.InvalidParameters("_subscribe",{eventType:"obrigatory"},this._subscribe);a.hasOwnProperty(b)||(a[b]=[]);var e=new Picasso.pjo.EventHandler(b,c,d||this);a[b].push(e)},this._unsubscribe=function(c,d,e){if("undefined"==typeof c)throw new Picasso.error.InvalidParameters("usubscribe",{eventType:"obrigatory"},this._unsubscribe);"undefined"==typeof d&&"undefined"==typeof e?delete a[c]:b("_unsubscribe",new Picasso.pjo.Event(c,[],e),d)},this.fire=function(a,c,d){if("undefined"==typeof a)throw new Picasso.error.InvalidParameters("fire",{eventType:"String"},this.fire);b("fire",new Picasso.pjo.Event(a,c,d||this))}},Picasso.load("Controller"),Picasso.Controller=function(){this._UIActions=[],this._model=null,this._views={},this.validator=new Picasso.form.Validator},Picasso.Controller.prototype._registerUIAction=function(a){for(var b=this._UIActions.length,c=0;b>c;c++){var d=this._UIActions[c];a._subscribe(d.eventName,d.callback)}},Picasso.Controller.prototype.construct=function(a){Picasso.Controller.apply(this,arguments),this._model=a;var b=arguments.length;if(b>1)for(var c=1;b>c;c++)arguments[c]instanceof Picasso.View&&(this.registerView(arguments[c]),arguments[c].setModel(a))},Picasso.Controller.prototype.registerView=function(a){a.setModel(this._model),this._views[a._seq]=a,this._registerUIAction(a)},Picasso.Controller.prototype.listen=function(a,b){var c=new Picasso.pjo.EventHandler(a,b,this);this._UIActions.push(c);for(var d in this._views)this._views.hasOwnProperty(d)&&this._views[d]._subscribe(a,b)},Picasso.Controller.extend=function(a){return Picasso.utils.object.extend(a,Picasso.Controller)},Picasso.load("Model"),Picasso.Model=function(){},Picasso.Model.prototype=new Picasso.core.Subject,Picasso.Model.prototype.construct=function(){if(!this.hasOwnProperty("_seq")){var a=new Picasso.core.Sequence("Model");this._seq=a.nextVal()}},Picasso.Model.extend=function(a){return Picasso.utils.object.extend(a,Picasso.Model)},Picasso.load("View"),Picasso.View=function(){this._model=null,this._modelEvents={},this._formBuilder=new Picasso.form.Builder,this.dom=null},Picasso.View.prototype=new Picasso.core.Subject,Picasso.View.prototype.construct=function(a){Picasso.View.apply(this,arguments),this.dom=a||document},Picasso.View.prototype.setModel=function(a){this._model=a;for(var b in this._modelEvents)this._modelEvents.hasOwnProperty(b)&&this._model._subscribe(b,this._modelEvents[b],this)},Picasso.View.prototype.buildForm=function(a){return this._formBuilder.buildForm(a)},Picasso.View.prototype.register=function(a,b){this._modelEvents[a]=b},Picasso.View.extend=function(a){return Picasso.utils.object.extend(a,Picasso.View)},Picasso.load("form.validators.hidden"),Picasso.form.validators.hidden=function(){var a=new Picasso.pjo.Validation;return a.valid=!0,a},Picasso.load("form.validators.number"),Picasso.form.validators.number=function(a){var b=a.value(),c=new Picasso.pjo.Validation;c.field=a,c.valid=!isNaN(Number(b)),c.valid||c.errorMessages.push("Field value is not a number")},Picasso.load("form.validators.password"),Picasso.form.validators.password=function(a){var b=new Picasso.pjo.Validation;return b.field=a,b.valid="undefined"!=typeof a.value(),b.valid||b.errorMessages.push("Field value is undefined"),b},Picasso.load("form.validators.text"),Picasso.form.validators.text=function(a){var b=new Picasso.pjo.Validation;return b.field=a,b.valid="undefined"!=typeof a.value(),b.valid||b.errorMessages.push("Field value is undefined"),b},Picasso.load("form.field.PicassoField"),Picasso.form.field.PicassoField=function(){var a=Picasso.load("core.Sequence"),b=Picasso.load("utils.html");this._id=null,this._element=null,this._label="",this._formIgnore=!1,this._required=!1,this._type="",this.__postConstructor__=function(a,b,c,d){this._label=a,this._type=b,this._required=c,this._formIgnore=d},this.build=function(){throw new Picasso.error.NotImplementedError("PicassoField","build")},this.isEmpty=function(){throw new Picasso.error.NotImplementedError("PicassoField","isEmpty")},this.value=function(){throw new Picasso.error.NotImplementedError("PicassoField","value")},this.reset=function(){throw new Picasso.error.NotImplementedError("PicassoField","reset")},this.getId=function(){return this._id},this.getLabel=function(){return this._label},this.isRequired=function(){return this._required},this.isFormIgnored=function(){return this._formIgnore},this.getType=function(){return this._type},this.setId=function(b){if(null==b||""==b){var c=this.type||"PicassoField";this._id=new a(c).nextVal()}else null!=this._element&&this._element.setAttribute("id",String(b)),this._id=b},this.addClass=function(a){b.addClass(this._element,a)},this.removeClass=function(a){b.removeClass(this._element,a)},this.getHTMLElement=function(){return this._element},this.setHTMLElement=function(a){a instanceof HTMLElement&&(this._element=a)}},Picasso.load("form.field.ButtonField"),Picasso.form.field.ButtonField=function(){var a=Picasso.load("utils.html");this.isEmpty=function(){return!1},this.value=function(){return this._element.value},this.build=function(b){this.setId(b.id);var c=document.createElement("button");a.setAttributes(c,{id:this.getId(),type:b.type||"button","class":"btn btn-default"}),a.setAttributes(c,b.attrs),c.innerHTML=b.value,this.formIgnore=!0,this.setHTMLElement(c)}},Picasso.form.field.ButtonField.prototype=new Picasso.form.field.PicassoField,Picasso.load("form.field.HiddenField"),Picasso.form.field.HiddenField=function(){var a=Picasso.load("utils.html");this.isEmpty=function(){return""==this.value()},this.value=function(a){var b=this._element;if("undefined"==typeof a){var c=b.value;return""==c?null:c}b.value=a},this.build=function(b){var c=document.createElement("input");a.setAttributes(c,{name:b.id||"",type:"hidden"}),a.setAttributes(c,b.attrs),this.setHTMLElement(c)}},Picasso.form.field.HiddenField.prototype=new Picasso.form.field.PicassoField,Picasso.load("form.field.InputField"),Picasso.form.field.InputField=function(){var a=Picasso.load("utils.html");this.isEmpty=function(){return""==this.value()},this.value=function(a){var b=this._element.getElementsByTagName("input")[0];return"undefined"==typeof a?b.value:void(b.value=a)},this.build=function(b){var c=document.createElement("div");c.setAttribute("class","form-group");var d=document.createElement("input");a.setAttributes(d,{name:b.id||"",type:b.type||"text"}),a.setAttributes(d,b.attrs),a.addClass(d,"form-control");var e=document.createElement("label");e.setAttribute("class","control-label"),e.innerHTML=b.label,c.appendChild(e),c.appendChild(d),this.setHTMLElement(c)}},Picasso.form.field.InputField.prototype=new Picasso.form.field.PicassoField,Picasso.load("form.Builder"),Picasso.form.Builder=function(){this.arrayUtils=Picasso.load("utils.array"),this.htmlUtils=Picasso.load("utils.html"),this.objUtils=Picasso.load("utils.object"),this.fieldFactory=new Picasso.form.FieldFactory},Picasso.form.Builder.prototype.buildFieldGrid=function(a,b){a=this.objUtils.deserialize(a,Picasso.pjo.FieldGrid);var c=document.createElement("div");this.htmlUtils.setAttributes(c,a.attrs),c.setAttribute("id",a.id);var d="col-xs-";d+=a.colXSize||Picasso.pjo.FieldGrid.colSize.MEDIUM,this.htmlUtils.addClass(c,"column "+d);var e=this;return this.arrayUtils.each(a.fields,function(a){var d=e.fieldFactory.create(a);b.addField(d),c.appendChild(d.getHTMLElement())}),c},Picasso.form.Builder.prototype.buildGridBlock=function(a,b){a=this.objUtils.deserialize(a,Picasso.pjo.GridBlock);var c=this,d=document.createElement("div");if(null!=a.legend||""!=a.legend){var e=document.createElement("p");e.innerHTML=a.legend,this.htmlUtils.addClass(e,"bg-info"),d.appendChild(e)}return this.htmlUtils.setAttributes(d,a.attrs),d.setAttribute("id",a.id),this.htmlUtils.addClass(d,"grid-block"),this.arrayUtils.each(a.fieldGrid,function(a){d.appendChild(c.buildFieldGrid(a,b))}),d},Picasso.form.Builder.prototype.buildForm=function(a){a=this.objUtils.deserialize(a,Picasso.pjo.Form);var b=new Picasso.form.PicassoForm,c=document.createElement("form");c.setAttribute("id",a.id),c.setAttribute("role","form"),c.setAttribute("novalidate","novalidate"),this.htmlUtils.setAttributes(c,a.attrs);var d=this;return this.arrayUtils.each(a.gridBlocks,function(a){c.appendChild(d.buildGridBlock(a,b))}),b.setHTMLElement(c),b},Picasso.load("form.FieldFactory"),Picasso.form.FieldFactory=function(){},Picasso.form.FieldFactory.constructors=function(){return{hidden:Picasso.form.field.HiddenField,text:Picasso.form.field.InputField,textArea:Picasso.form.field.InputField,email:Picasso.form.field.InputField,password:Picasso.form.field.InputField,submit:Picasso.form.field.ButtonField,cancel:Picasso.form.field.ButtonField,button:Picasso.form.field.ButtonField}}(),Picasso.form.FieldFactory.prototype._setPicassoAttributes=function(a){var b=Picasso.load("utils.html");a.required&&b.addClass(a.getHTMLElement(),"prequired"),a.formIgnore&&b.addClass(a.getHTMLElement(),"pform-ignore")},Picasso.form.FieldFactory.prototype._getFieldConstructorByFieldType=function(a){var b=this.constructor.constructors;if(b.hasOwnProperty(a)){var c=b[a];return"string"==typeof c?this[c]:c}throw new Picasso.error.InvalidFieldType(a)},Picasso.form.FieldFactory.prototype.create=function(a){var b=Picasso.load("utils.object");a=b.deserialize(a,Picasso.pjo.Field);var c=this._getFieldConstructorByFieldType(a.type),d=new c;return d.__postConstructor__(a.label,a.type,a.required,a.formIgnore),d.build(a),a.hasOwnProperty("id")&&d.setId(a.id),null!=a.value&&d.value(a.value),this._setPicassoAttributes(d),d},Picasso.form.FieldFactory.prototype.registerConstructor=function(a,b){Picasso.form.FieldFactory.constructors[a]=b},Picasso.load("form.PicassoForm"),Picasso.form.PicassoForm=function(){var a={},b=null;this.addField=function(b){a[b.getId()]=b},this.getFields=function(){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},this.getField=function(b){return a.hasOwnProperty(b)?a[b]:null},this.setHTMLElement=function(a){b=a},this.getHTMLElement=function(){return b},this.value=function(a){var b=this.getFields();if("undefined"==typeof a){for(var c={},d=0;d<b.length;d++){var e=b[d].getId();"undefined"==typeof e||b[d].formIgnore||(c[e]=b[d].value())}return c}for(var f in a)a.hasOwnProperty(f)&&this.getField(f).value(a[f])}},Picasso.load("form.Renderer"),Picasso.form.Renderer=function(a){this.container=a},Picasso.form.Renderer.prototype.render=function(){},Picasso.load("form.Validator"),Picasso.form.Validator=function(a){var b=Picasso.load("utils.log");this.validate=function(a){var c=new Picasso.pjo.Validation;return c.field=a,c.valid=!1,a.isRequired()&&a.isEmpty()?(c.errorMessages.push("Field is required"),c):Picasso.form.validators.hasOwnProperty(a.getType())?Picasso.form.validators[a.getType()](a):(b.warn("No validator found to the field type "+a.getType(),a),c.valid=null,c)},this.validateForm=function(a){for(var b=a.getFields(),c={},d=0;d<b.length;d++){var e=b[d];e.isFormIgnored()||(c[e.getId()]=this.validate(e))}return c}};