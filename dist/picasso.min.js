/* Picasso
 * A Framework to build dinamic forms using MVC
 * Build date: Sun, 11 Oct 2015 03:00:09 GMT
 * @author Rubens Pinheiro Gon√ßalves Cavalcante
 * @version 0.9.4
 * @license GPL-3.0
 */

var Picasso=Picasso||{},P=P||Picasso;Picasso.info={author:"%author%",version:"%version%",build:"%buildDate%",license:"%license%"},Picasso.load=function(t){var e=t.split("."),i=Picasso;"Picasso"===e[0]&&(e=e.slice(1));for(var o=0;o<e.length;o++)"undefined"==typeof i[e[o]]&&(i[e[o]]={}),i=i[e[o]];return i},Picasso.load("loadField"),Picasso.loadField=function(t){var e=new Picasso.form.FieldFactory;try{return e.create(t)}catch(i){var o=Picasso.load("utils.log");return o.error(i.message),null}},Picasso.load("extend"),Picasso.extend.field=function(t,e){var i=Picasso.load("utils.object"),o=Picasso.load("utils.log");if("function"!=typeof e)throw new Picasso.error.InvalidParameters("Picasso.extend.field",{Field:"Invalid constructor"},this);i.isEmpty(e.prototype)||o.warn("Overriding the field prototype from given constructor",e),e.prototype=new Picasso.form.field.PicassoField,Picasso.form.FieldFactory.constructors.hasOwnProperty(t)&&o.warn("Overriding a already registered Picasso field "+t),Picasso.form.FieldFactory.constructors[t]=e},Picasso.extend.validator=function(t,e){var i=(Picasso.load("utils.object"),Picasso.load("utils.log"));if("function"!=typeof e)throw new Picasso.error.InvalidParameters("Picasso.extend.validator",{validator:"Invalid function"},this);Picasso.form.validators.hasOwnProperty(t)&&i.warn("Overriding a already registered Picasso field validator "+t),Picasso.form.validators[t]=e},Picasso.load("pjo.Event"),Picasso.pjo.Event=function(t,e,i){this.name=t||"any",this.data=e||null,this.target=i||null},Picasso.load("pjo.EventHandler"),Picasso.pjo.EventHandler=function(t,e,i){this.eventName=t||"",this.callback=e||new Function,this.context=i||null},Picasso.load("pjo.Column"),Picasso.pjo.Column=function(){this.id=null,this.index=0,this.colXSize=3,this.fields=[]},Picasso.pjo.Column.colSize={SMALL:2,MEDIUM:3,LARGE:4},Picasso.load("pjo.Field"),Picasso.pjo.Field=function(){this.id=null,this.label="",this.type=null,this.required=!1,this.formIgnore=!1,this.value=null,this.attrs={name:""}},Picasso.pjo.Field.type={TEXT:"text",TEXTAREA:"textarea",NUMBER:"number",EMAIL:"email",PASSWORD:"password",SUBMIT:"submit",CANCEL:"cancel"},Picasso.load("pjo.Form"),Picasso.pjo.Form=function(){this.id=null,this.attrs={action:"",method:"",name:""},this.grid=null},Picasso.load("pjo.Grid"),Picasso.pjo.Grid=function(){this.id=null,this.legend=null,this.attrs={},this.columns=[]},Picasso.load("pjo.Validation"),Picasso.pjo.Validation=function(){this.field=null,this.errorMessages=[],this.valid=!1},Picasso.load("error.InvalidFieldType"),Picasso.error.InvalidFieldType=function(t){this.name="InvalidFieldType",this.message="Can't find a constructor. Invalid field type "+String(t)},Picasso.error.InvalidFieldType.prototype=Error.prototype,Picasso.error.InvalidFieldType.constructor=Picasso.error.InvalidFieldType,Picasso.load("error.InvalidParameters"),Picasso.error.InvalidParameters=function(t,e,i){this.name="InvalidParameters",this.message="The function "+t+" has received invalid parameters\n";var o="	parameter %param%: %dependence%;\n";for(var s in e)e.hasOwnProperty(s)&&(this.message+=o.replace("%param%",s).replace("%dependence%",e[s]));this.errorParameters=e||null,this.context=i||null},Picasso.error.InvalidParameters.prototype=Error.prototype,Picasso.error.InvalidParameters.constructor=Picasso.error.InvalidParameters,Picasso.load("error.NotImplementedError"),Picasso.error.NotImplementedError=function(t,e){this.name="NotImplementedError",this.message=t+" object child must implement the "+e+" method"},Picasso.error.NotImplementedError.prototype=Error.prototype,Picasso.error.NotImplementedError.constructor=Picasso.error.NotImplementedError,Picasso.load("utils.array"),Picasso.utils.array=function(){var t=function(t,e){for(var i=Picasso.load("Picasso.utils.object"),o=0;o<t.length;o++)if("object"==typeof t[o]&&"object"==typeof e){if(i.equals(t[o],e))return!0}else if(t[o]===e)return!0;return!1},e=function(e,i){if(e.length!=i.length)return!1;for(var o=0;o<i.length;o++)if(!t(e,i[o]))return!1;return!0},i=function(t,e){if("undefined"!=typeof t){var i,o;for(o=t.length,i=0;o>i;i++)e(t[i],i)}};return{find:t,equals:e,each:i}}(),Picasso.load("utils.html"),Picasso.utils.html=function(){var t=function(t,e){for(var i in e)e.hasOwnProperty(i)&&t.setAttribute(i,e[i])},e=function(t,e){var i,o,s=t.classList;for(i=-1!=e.indexOf(" ")?e.split(" "):[e],o=0;o<i.length;o++)s.contains(i[o])||s.add(i[o])},i=function(t,e){var i,o,s=t.classList;for(i=-1!=e.indexOf(" ")?e.split(" "):[e],o=0;o<i.length;o++)s.contains(i[o])||s.remove(i[o])};return{setAttributes:t,addClass:e,removeClass:i}}(),Picasso.load("utils.log"),Picasso.utils.log=function(){var t={ERROR:"error",WARN:"warn",INFO:"info",DISABLED:"disabled"},e=t.DISABLED,i=function(i,o){e==t.INFO&&(o=o||"(no context informed)",console.info(i,o))},o=function(i,o){(e==t.INFO||e==t.WARN)&&(o=o||"(no context informed)",console.warn(i,o))},s=function(i,o){(e==t.INFO||e==t.WARN||e==t.ERROR)&&(o=o||"(no context informed)",console.error(i,o))},r=function(t){e=t},n=function(){return e};return{lvs:t,info:i,warn:o,error:s,setLogLevel:r,getLogLevel:n}}(),Picasso.load("utils.object"),Picasso.utils.object=function(){var t=function(t){return t.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})},e=function(t,e){var i=new Function;return i.prototype=e.prototype,t.prototype=new i,t._super=e.prototype,t.prototype.constructor=t,t},i=function(t,e){if(t instanceof Object){var i;for(i in t)t.hasOwnProperty(i)&&e(t[i],i)}},o=function(t,e){var i;for(i in t)if("undefined"==typeof e[i])return!1;for(i in t)if(t[i])switch(typeof t[i]){case"object":if(!t[i].equals(e[i]))return!1;break;case"function":if("undefined"==typeof e[i]||"equals"!=i&&t[i].toString()!=e[i].toString())return!1;break;default:if(t[i]!=e[i])return!1}else if(e[i])return!1;for(i in e)if("undefined"==typeof t[i])return!1;return!0},s=function(e,i){var o=new i,s={};for(var r in e)e.hasOwnProperty(r)&&(-1!=r.indexOf("-")?s[t(r)]=e[r]:s[r]=e[r]);for(var n in o)o.hasOwnProperty(n)&&s.hasOwnProperty(n)&&(o[n]=s[n]);return o},r=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};return{extend:e,equals:o,each:i,deserialize:s,isEmpty:r}}(),Picasso.load("core.Sequence"),Picasso.core.Sequence=function(){var t={},e=function(e){return"undefined"==typeof e||"string"!=typeof e?!1:(t.hasOwnProperty(e)||(t[e]=null),!0)},i=function(t){this._entity=t};return i.prototype.currentVal=function(){return e(this._entity)?t[this._entity]:null},i.prototype.nextVal=function(){return e(this._entity)?null==t[this._entity]?(t[this._entity]=0,0):++t[this._entity]:null},i}(),Picasso.load("core.Subject"),Picasso.core.Subject=function(){var t={},e=function(e,i,o){for(var s=t[i.name]||[],r=0;r<s.length;r++)if("fire"==e){var n=s[r].callback;"string"==typeof n&&s[r].context.hasOwnProperty(n)?s[r].context[n](i):s[r].callback.call(s.context,i)}else s[r].callback!==o||null!=i.context&&s.context!==i.context||s.splice(r,1)};this._subscribe=function(e,i,o){if("undefined"==typeof e)throw new Picasso.error.InvalidParameters("_subscribe",{eventType:"obrigatory"},this._subscribe);t.hasOwnProperty(e)||(t[e]=[]);var s=new Picasso.pjo.EventHandler(e,i,o||this);t[e].push(s)},this._unsubscribe=function(i,o,s){if("undefined"==typeof i)throw new Picasso.error.InvalidParameters("usubscribe",{eventType:"obrigatory"},this._unsubscribe);"undefined"==typeof o&&"undefined"==typeof s?delete t[i]:e("_unsubscribe",new Picasso.pjo.Event(i,[],s),o)},this.fire=function(t,i,o){if("undefined"==typeof t)throw new Picasso.error.InvalidParameters("fire",{eventType:"String"},this.fire);e("fire",new Picasso.pjo.Event(t,i,o||this))}},Picasso.load("Collection"),Picasso.Collection=function(t){var e=Picasso.utils.object.extend(Picasso.Collection.MetaConstructor,Array),i=new e;return i.setCollectionType(t),i},Picasso.Collection.MetaConstructor=function(){this.setCollectionType=function(t){this.ModelConstructor=t},this.clear=function(){for(var t=0,e=this.length;e>t;t++)this.pop()},this.each=function(t){for(var e=0,i=this.length;i>e;e++)t(this[e],e)},this.getElement=function(t){for(var e=0;e<this.length;e++)if(this[e].id==t)return this[e];return null},this.addElement=function(t){var e=new this.ModelConstructor;e.update(t),this.push(e)},this.addElements=function(t){for(var e=0;e<t.length;e++)this.addElement(t[e])},this.removeElement=function(t){for(var e=0;e<this.length;e++)if(this[e].id==t)return this.splice(e,1)},this.updateElement=function(t,e){t.hasOwnProperty(e)&&"undefined"!=typeof e||(e="id");for(var i=0;i<this.length;i++)this[i].hasOwnProperty(e)&&t.hasOwnProperty(e)&&t[e]===this[i][e]&&this[i].update(t)}},Picasso.load("Controller"),Picasso.Controller=function(t,e){this._UIActions=[],this._model=null,this._views={},this.validator=new Picasso.form.Validator},Picasso.Controller.prototype._registerUIAction=function(t){for(var e=this._UIActions.length,i=0;e>i;i++){var o=this._UIActions[i];t._subscribe(o.eventName,o.callback)}},Picasso.Controller.prototype.construct=function(t){Picasso.Controller.apply(this,arguments),this._model=t;var e=arguments.length;if(e>1)for(var i=1;e>i;i++)arguments[i]instanceof Picasso.View&&(this.registerView(arguments[i]),arguments[i].setModel(t))},Picasso.Controller.prototype.registerView=function(t){t.setModel(this._model),this._views[t._seq]=t,this._registerUIAction(t)},Picasso.Controller.prototype.listen=function(t,e){var i=new Picasso.pjo.EventHandler(t,e,this);this._UIActions.push(i);for(var o in this._views)this._views.hasOwnProperty(o)&&this._views[o]._subscribe(t,e)},Picasso.Controller.prototype.getModel=function(){return this._model},Picasso.Controller.prototype.setModel=function(t){for(var e in this._views)this._views.hasOwnProperty(e)&&this._views[e].setModel(t)},Picasso.Controller.extend=function(t){return Picasso.utils.object.extend(t,Picasso.Controller)},Picasso.load("Model"),Picasso.Model=function(){},Picasso.Model.prototype=new Picasso.core.Subject,Picasso.Model.prototype.set=function(t,e){this.hasOwnProperty(t)&&(this[t]instanceof Picasso.Model?this[t].update(e):(this[t]=e,this.fire("propertyChange",{property:t,value:e})))},Picasso.Model.prototype.get=function(t){return this.hasOwnProperty(t)?this[t]:void 0},Picasso.Model.prototype.update=function(t){for(var e in t)t.hasOwnProperty(e)&&this.set(e,t[e])},Picasso.Model.prototype.toPlainObject=function(){var t=new this.constructor;for(var e in t)t.hasOwnProperty(e)&&"function"!=typeof t[e]&&(t[e]=this[e]);return t},Picasso.Model.extend=function(t){var e=[],i=new t;for(var o in i)i.hasOwnProperty(o)&&e.push(o);for(var s=Picasso.utils.object.extend(t,Picasso.Model),r=0;r<e.length;r++)!function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);s.prototype["set"+e]=function(e){this.set(t,e)},s.prototype["get"+e]=function(){return this.get(t)}}(e[r]);return s},Picasso.load("View"),Picasso.View=function(){this._model=null,this._form=null,this._modelEvents={},this._formBuilder=new Picasso.form.Builder,this.dom=null},Picasso.View.prototype=new Picasso.core.Subject,Picasso.View.prototype.construct=function(t){Picasso.View.apply(this,arguments),this.dom=t||document},Picasso.View.prototype.setModel=function(t){this._model=t;for(var e in this._modelEvents)this._modelEvents.hasOwnProperty(e)&&this._model._subscribe(e,this._modelEvents[e],this)},Picasso.View.prototype.bindFormData=function(){var t=this;this._model._subscribe("propertyChange",function(e){var i=e.data.property,o=e.data.value;if(null!=t._form){var s=t._form.getField(i);s.value(o)}})},Picasso.View.prototype.buildForm=function(t){return this._formBuilder.buildForm(t)},Picasso.View.prototype.setForm=function(t){this._form=t},Picasso.View.prototype.getForm=function(){return this._form},Picasso.View.prototype.register=function(t,e){this._modelEvents[t]=e},Picasso.View.extend=function(t){return Picasso.utils.object.extend(t,Picasso.View)},Picasso.load("form.validators.text"),Picasso.form.validators.email=function(t){var e=new Picasso.pjo.Validation;e.field=t,e.valid="undefined"!=typeof t.value(),!e.valid&&t.isRequired()&&e.errorMessages.push("Field value is undefined");var i=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return!i.test(t.value())&&t.isRequired()&&(e.valid=!1,e.errorMessages.push("Field contains a invalid email")),e},Picasso.load("form.validators.hidden"),Picasso.form.validators.hidden=function(t){var e=new Picasso.pjo.Validation;return e.valid=!0,e},Picasso.load("form.validators.number"),Picasso.form.validators.number=function(t){var e=t.value(),i=new Picasso.pjo.Validation;i.field=t,i.valid=!isNaN(Number(e)),i.valid||i.errorMessages.push("Field value is not a number")},Picasso.load("form.validators.password"),Picasso.form.validators.password=function(t){var e=new Picasso.pjo.Validation;return e.field=t,e.valid="undefined"!=typeof t.value(),e.valid||e.errorMessages.push("Field value is undefined"),e},Picasso.load("form.validators.text"),Picasso.form.validators.text=function(t){var e=new Picasso.pjo.Validation;return e.field=t,e.valid="undefined"!=typeof t.value(),e.valid||e.errorMessages.push("Field value is undefined"),e},Picasso.load("form.field.PicassoField"),Picasso.form.field.PicassoField=function(t,e,i,o){var s=Picasso.load("core.Sequence"),r=Picasso.load("utils.html");this._id=null,this._element=null,this._label="",this._formIgnore=!1,this._required=!1,this._type="",this.__postConstructor__=function(t,e,i,o){this._label=t,this._type=e,this._required=i,this._formIgnore=o},this.build=function(t){throw new Picasso.error.NotImplementedError("PicassoField","build")},this.isEmpty=function(){throw new Picasso.error.NotImplementedError("PicassoField","isEmpty")},this.value=function(t){throw new Picasso.error.NotImplementedError("PicassoField","value")},this.reset=function(){throw new Picasso.error.NotImplementedError("PicassoField","reset")},this.getId=function(){return this._id},this.getLabel=function(){return this._label},this.isRequired=function(){return this._required},this.isFormIgnored=function(){return this._formIgnore},this.getType=function(){return this._type},this.setId=function(t){if(null==t||""==t){var e=this.type||"PicassoField";this._id=new s(e).nextVal()}else null!=this._element&&this._element.setAttribute("id",String(t)),this._id=t},this.addClass=function(t){r.addClass(this._element,t)},this.removeClass=function(t){r.removeClass(this._element,t)},this.getHTMLElement=function(){return this._element},this.setHTMLElement=function(t){t instanceof HTMLElement&&(this._element=t)}},Picasso.load("form.field.ButtonField"),Picasso.form.field.ButtonField=function(){var t=Picasso.load("utils.html");this.isEmpty=function(){return!1},this.value=function(){return this._element.value},this.build=function(e){this.setId(e.id);var i=document.createElement("button");t.setAttributes(i,{id:this.getId(),type:e.type||"button","class":"btn btn-default"}),t.setAttributes(i,e.attrs),i.innerHTML=e.value,this.formIgnore=!0,this.setHTMLElement(i)}},Picasso.form.field.ButtonField.prototype=new Picasso.form.field.PicassoField,Picasso.load("form.field.HiddenField"),Picasso.form.field.HiddenField=function(){var t=Picasso.load("utils.html");this.isEmpty=function(){return""==this.value()},this.value=function(t){var e=this._element;if("undefined"==typeof t){var i=e.value;return""==i?null:i}e.value=t},this.build=function(e){var i=document.createElement("input");t.setAttributes(i,{name:e.id||"",type:"hidden"}),t.setAttributes(i,e.attrs),this.setHTMLElement(i)}},Picasso.form.field.HiddenField.prototype=new Picasso.form.field.PicassoField,Picasso.load("form.field.InputField"),Picasso.form.field.InputField=function(){var t=Picasso.load("utils.html");this.isEmpty=function(){return""==this.value()},this.value=function(t){var e=this._element.getElementsByTagName("input")[0];return"undefined"==typeof t?e.value:void(e.value=t)},this.build=function(e){var i=document.createElement("div");i.setAttribute("class","form-group");var o=document.createElement("input");t.setAttributes(o,{name:e.id||"",type:e.type||"text"}),t.setAttributes(o,e.attrs),t.addClass(o,"form-control");var s=document.createElement("label");s.setAttribute("class","control-label"),s.innerHTML=e.label,i.appendChild(s),i.appendChild(o),this.setHTMLElement(i)}},Picasso.form.field.InputField.prototype=new Picasso.form.field.PicassoField,Picasso.load("form.Builder"),Picasso.form.Builder=function(){this.arrayUtils=Picasso.load("utils.array"),this.htmlUtils=Picasso.load("utils.html"),this.objUtils=Picasso.load("utils.object"),this.fieldFactory=new Picasso.form.FieldFactory},Picasso.form.Builder.prototype.buildColumn=function(t,e){t=this.objUtils.deserialize(t,Picasso.pjo.Column);var i=document.createElement("div");this.htmlUtils.setAttributes(i,t.attrs),i.setAttribute("id",t.id);var o="col-xs-";o+=t.colXSize||Picasso.pjo.Column.colSize.MEDIUM,this.htmlUtils.addClass(i,"column "+o);var s=this;return this.arrayUtils.each(t.fields,function(t){var o=s.fieldFactory.create(t);e.addField(o),i.appendChild(o.getHTMLElement())}),i},Picasso.form.Builder.prototype.buildGrid=function(t,e){t=this.objUtils.deserialize(t,Picasso.pjo.Grid);var i=this,o=document.createElement("div");if(null!=t.legend||""!=t.legend){var s=document.createElement("p");s.innerHTML=t.legend,this.htmlUtils.addClass(s,"bg-info"),o.appendChild(s)}return this.htmlUtils.setAttributes(o,t.attrs),o.setAttribute("id",t.id),this.htmlUtils.addClass(o,"grid-block"),this.arrayUtils.each(t.columns,function(t){o.appendChild(i.buildColumn(t,e))}),o},Picasso.form.Builder.prototype.buildForm=function(t){t=this.objUtils.deserialize(t,Picasso.pjo.Form);var e=new Picasso.form.PicassoForm,i=document.createElement("form");i.setAttribute("id",t.id),i.setAttribute("role","form"),i.setAttribute("novalidate","novalidate"),this.htmlUtils.setAttributes(i,t.attrs);var o=this;return this.arrayUtils.each(t.grid,function(t){i.appendChild(o.buildGrid(t,e))}),e.setHTMLElement(i),e},Picasso.load("form.FieldFactory"),Picasso.form.FieldFactory=function(){},Picasso.form.FieldFactory.constructors=function(){return{hidden:Picasso.form.field.HiddenField,text:Picasso.form.field.InputField,textArea:Picasso.form.field.InputField,email:Picasso.form.field.InputField,password:Picasso.form.field.InputField,submit:Picasso.form.field.ButtonField,cancel:Picasso.form.field.ButtonField,button:Picasso.form.field.ButtonField}}(),Picasso.form.FieldFactory.prototype._setPicassoAttributes=function(t){var e=Picasso.load("utils.html");t.required&&e.addClass(t.getHTMLElement(),"prequired"),t.formIgnore&&e.addClass(t.getHTMLElement(),"pform-ignore")},Picasso.form.FieldFactory.prototype._getFieldConstructorByFieldType=function(t){var e=this.constructor.constructors;if(e.hasOwnProperty(t)){var i=e[t];return"string"==typeof i?this[i]:i}throw new Picasso.error.InvalidFieldType(t)},Picasso.form.FieldFactory.prototype.create=function(t){var e=Picasso.load("utils.object");t=e.deserialize(t,Picasso.pjo.Field);var i=this._getFieldConstructorByFieldType(t.type),o=new i;return o.__postConstructor__(t.label,t.type,t.required,t.formIgnore),o.build(t),t.hasOwnProperty("id")&&o.setId(t.id),null!=t.value&&o.value(t.value),this._setPicassoAttributes(o),o},Picasso.load("form.PicassoForm"),Picasso.form.PicassoForm=function(){var t={},e=null;this.valid=!1,this.addField=function(e){t[e.getId()]=e},this.getFields=function(){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},this.getField=function(e){return t.hasOwnProperty(e)?t[e]:null},this.setHTMLElement=function(t){e=t},this.getHTMLElement=function(){return e},this.value=function(t){var e=this.getFields();if("undefined"==typeof t){for(var i={},o=0;o<e.length;o++){var s=e[o].getId();"undefined"==typeof s||e[o].formIgnore||(i[s]=e[o].value())}return i}for(var r in t)t.hasOwnProperty(r)&&this.getField(r).value(t[r])}},Picasso.Form=Picasso.form.PicassoForm,Picasso.load("form.Renderer"),Picasso.form.Renderer=function(t){this.container=t},Picasso.form.Renderer.prototype.render=function(t){},Picasso.load("form.Validator"),Picasso.form.Validator=function(t){var e=Picasso.load("utils.log");this.validate=function(t){var i=new Picasso.pjo.Validation;return i.field=t,i.valid=!1,t.isRequired()&&t.isEmpty()?(i.errorMessages.push("Field is required"),i):Picasso.form.validators.hasOwnProperty(t.getType())?Picasso.form.validators[t.getType()](t):(e.warn("No validator found to the field type "+t.getType(),t),i.valid=null,i)},this.validateForm=function(t){for(var e=t.getFields(),i={},o=!0,s=0;s<e.length;s++){var r=e[s];r.isFormIgnored()||(i[r.getId()]=this.validate(r),null!==i[r.getId()].valid&&(o=o&&!!i[r.getId()].valid))}return t.valid=o,i}};